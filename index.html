<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Siga-Pesca | ASSOPESCA</title>
    <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-green: #27ae60; /* Verde Institucional */
            --dark-green: #1e8449;
            --bg-light: #f0f4f1;
            --white: #ffffff;
            --danger: #e74c3c;
        }
        
        body { font-family: 'Segoe UI', Roboto, sans-serif; margin: 0; background: var(--bg-light); color: #2c3e50; }
        .hidden { display: none !important; }

        /* Login Personalizado */
        #login-screen { 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: linear-gradient(135deg, var(--primary-green), #2ecc71); 
        }
        .login-box { 
            background: var(--white); 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 20px rgba(0,0,0,0.15); 
            width: 100%; 
            max-width: 380px; 
            text-align: center;
        }
        <https://www.instagram.com/p/DVT7sv1EUIX/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ==> { 
            background: #eee; 
            height: 80px; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            border-radius: 8px;
            font-weight: bold;
            color: var(--primary-green);
            border: 2px dashed var(--primary-green);
        }

        /* Header e Nav */
        nav { 
            background: var(--primary-green); 
            color: white; 
            padding: 10px 5%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        /* Container e Cards */
        .container { padding: 30px 5%; max-width: 1200px; margin: auto; }
        .card { 
            background: var(--white); 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            margin-bottom: 25px; 
            border-top: 4px solid var(--primary-green);
        }

        /* Formul√°rios e Bot√µes */
        input, select, button { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border: 1px solid #cbd5e0; 
            border-radius: 6px; 
            font-size: 14px;
        }
        button { 
            background: var(--primary-green); 
            color: white; 
            border: none; 
            cursor: pointer; 
            font-weight: 600; 
            transition: background 0.2s;
        }
        button:hover { background: var(--dark-green); }
        .btn-admin { background: #34495e; }
        .btn-logout { background: transparent; border: 1px solid white; width: auto; padding: 6px 15px; }
        .btn-logout:hover { background: rgba(255,255,255,0.2); }

        /* Tabelas */
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th { background: #f8faf9; color: var(--dark-green); text-align: left; padding: 12px; border-bottom: 2px solid #edf2f0; }
        td { padding: 12px; border-bottom: 1px solid #edf2f0; font-size: 14px; }

        .dashboard-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; }
        @media (max-width: 850px) { .dashboard-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <div class="logo-placeholder">LOGOMARCA ASSOPESCA</div>
            <h2 style="margin-bottom: 20px; color: #2d3748;">Siga-Pesca</h2>
            <input type="text" id="login-user" placeholder="Usu√°rio">
            <input type="password" id="login-pass" placeholder="Senha">
            <button onclick="handleLogin()">Acessar Sistema</button>
            <p id="login-msg" style="color: var(--danger); font-size: 13px; margin-top: 10px;"></p>
        </div>
    </div>

    <div id="password-screen" class="hidden">
        <div id="login-screen"> <div class="login-box">
                <h3>üîí Seguran√ßa</h3>
                <p style="font-size: 14px; color: #718096;">Primeiro acesso detectado. Altere sua senha padr√£o.</p>
                <input type="password" id="new-pass" placeholder="Nova Senha">
                <button onclick="updatePassword()">Salvar e Entrar</button>
            </div>
        </div>
    </div>

    <div id="main-screen" class="hidden">
        <nav>
            <div><strong>ASSOPESCA</strong> | <small id="user-display"></small></div>
            <button class="btn-logout" onclick="logout()">Sair</button>
        </nav>

        <div class="container">
            <div id="colab-area" class="hidden">
                <div class="card">
                    <h3>üìù Novo Atendimento</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" id="socio-nome" placeholder="Nome do S√≥cio">
                        <input type="text" id="socio-inscricao" placeholder="N¬∫ Inscri√ß√£o">
                    </div>
                    <select id="atendimento-servico"></select>
                    <button onclick="saveAttendance()">Registrar Atendimento</button>
                </div>
                <div class="card">
                    <h3>Hist√≥rico Pessoal</h3>
                    <table id="table-colab">
                        <thead>
                            <tr><th>Data/Hora</th><th>S√≥cio</th><th>Servi√ßo</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="admin-area" class="hidden">
                <div class="dashboard-grid">
                    <div class="card">
                        <h3>üìä Produtividade da Equipe</h3>
                        <canvas id="chartGeneral" height="150"></canvas>
                    </div>
                    <div class="card">
                        <h3>‚öôÔ∏è Gest√£o</h3>
                        <button onclick="exportToExcel()">üì• Exportar Relat√≥rio Excel</button>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;">
                        <h4>Novo Colaborador</h4>
                        <input type="text" id="new-user-name" placeholder="Nome Completo">
                        <select id="new-user-role">
                            <option value="colab">Colaborador Operacional</option>
                            <option value="admin">Diretoria</option>
                        </select>
                        <button class="btn-admin" onclick="addNewUser()">Cadastrar Usu√°rio</button>
                    </div>
                </div>
                <div class="card">
                    <h3>üìã Relat√≥rio Geral de Atendimentos</h3>
                    <table id="table-admin">
                        <thead>
                            <tr><th>Colaborador</th><th>S√≥cio</th><th>Servi√ßo</th><th>Data/Hora</th></tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        /* CONFIGURA√á√ÉO DE DADOS INICIAIS [cite: 13, 115, 119] */
        const INITIAL_SERVICES = [
            "Manuten√ß√£o RGP", "Edi√ß√£o dados RGP", "Solicita√ß√£o RGP novo", "Recadastramento", 
            "Recurso RGP suspenso", "Emiss√£o declara√ß√µes", "Aposentadoria", "Sal√°rio Materno", 
            "Aux√≠lio Doen√ßa", "Protocolo Seguro Defeso", "Consulta Seguro Defeso", 
            "Recursos Seguro Defeso", "Atualiza√ß√£o Cadastro (INSS/RF)", 
            "Emiss√£o NIT/CEI", "Emiss√£o Carteira RGP", "Carteira de S√≥cio"
        ];

        const INITIAL_USERS = [
            { user: "antonio", pass: "123", name: "Ant√¥nio", role: "admin", firstAccess: true },
            { user: "marcio", pass: "123", name: "M√°rcio", role: "admin", firstAccess: true },
            { user: "arthur", pass: "123", name: "Arthur", role: "admin", firstAccess: true },
            { user: "elizangela", pass: "123", name: "Eliz√¢ngela", role: "colab", firstAccess: true },
            { user: "raquel", pass: "123", name: "Raquel", role: "colab", firstAccess: true },
            { user: "fernando", pass: "123", name: "Fernando", role: "colab", firstAccess: true },
            { user: "sarah", pass: "123", name: "Sarah", role: "colab", firstAccess: true },
            { user: "mayla", pass: "123", name: "Mayla", role: "colab", firstAccess: true },
            { user: "halana", pass: "123", name: "Halana", role: "colab", firstAccess: true },
            { user: "wanda", pass: "123", name: "Wanda", role: "colab", firstAccess: true },
            { user: "terezinha", pass: "123", name: "Terezinha", role: "colab", firstAccess: true }
        ];

        let currentUser = null;
        let db = JSON.parse(localStorage.getItem('assopesca_v2')) || {
            users: INITIAL_USERS,
            services: INITIAL_SERVICES,
            records: []
        };

        const save = () => localStorage.setItem('assopesca_v2', JSON.stringify(db));

        /* L√ìGICA DE LOGIN [cite: 96, 120] */
        function handleLogin() {
            const u = document.getElementById('login-user').value.toLowerCase();
            const p = document.getElementById('login-pass').value;
            const user = db.users.find(x => x.user === u && x.pass === p);

            if (user) {
                currentUser = user;
                user.firstAccess ? showScreen('password-screen') : initApp();
            } else {
                document.getElementById('login-msg').innerText = "Credenciais incorretas.";
            }
        }

        function updatePassword() {
            const np = document.getElementById('new-pass').value;
            if(np.length < 3) return alert("Senha muito curta.");
            const idx = db.users.findIndex(x => x.user === currentUser.user);
            db.users[idx].pass = np;
            db.users[idx].firstAccess = false;
            save();
            initApp();
        }

        function showScreen(id) {
            ['login-screen', 'password-screen', 'main-screen'].forEach(s => document.getElementById(s).classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function initApp() {
            showScreen('main-screen');
            document.getElementById('user-display').innerText = currentUser.name.toUpperCase();
            
            if (currentUser.role === 'admin') {
                document.getElementById('admin-area').classList.remove('hidden');
                updateAdminView();
            } else {
                document.getElementById('colab-area').classList.remove('hidden');
                const sel = document.getElementById('atendimento-servico');
                sel.innerHTML = db.services.map(s => `<option value="${s}">${s}</option>`).join('');
                updateColabTable();
            }
        }

        /* REGISTRO DE ATENDIMENTOS [cite: 100, 110, 125] */
        function saveAttendance() {
            const sNome = document.getElementById('socio-nome').value;
            const sInsc = document.getElementById('socio-inscricao').value;
            const serv = document.getElementById('atendimento-servico').value;

            if(!sNome || !sInsc) return alert("Informe S√≥cio e Inscri√ß√£o.");

            db.records.push({
                colab: currentUser.name,
                socio: sNome,
                insc: sInsc,
                serv: serv,
                time: new Date().toLocaleString('pt-BR')
            });
            save();
            document.getElementById('socio-nome').value = '';
            document.getElementById('socio-inscricao').value = '';
            updateColabTable();
            alert("‚úÖ Registro salvo!");
        }

        function updateColabTable() {
            const my = db.records.filter(r => r.colab === currentUser.name).reverse();
            document.querySelector('#table-colab tbody').innerHTML = my.map(r => 
                `<tr><td>${r.time}</td><td>${r.socio}</td><td>${r.serv}</td></tr>`
            ).join('');
        }

        /* DASHBOARD DIRETORIA [cite: 101, 102, 121, 123] */
        function updateAdminView() {
            document.querySelector('#table-admin tbody').innerHTML = db.records.slice().reverse().map(r => 
                `<tr><td>${r.colab}</td><td>${r.socio}</td><td>${r.serv}</td><td>${r.time}</td></tr>`
            ).join('');

            const stats = {};
            db.records.forEach(r => stats[r.colab] = (stats[r.colab] || 0) + 1);

            const ctx = document.getElementById('chartGeneral').getContext('2d');
            if(window.chart) window.chart.destroy();
            window.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(stats),
                    datasets: [{
                        label: 'Atendimentos',
                        data: Object.values(stats),
                        backgroundColor: '#27ae60'
                    }]
                },
                options: { plugins: { legend: { display: false } } }
            });
        }

        function addNewUser() {
            const name = document.getElementById('new-user-name').value;
            const role = document.getElementById('new-user-role').value;
            if(!name) return;
            const userKey = name.toLowerCase().split(' ')[0] + Math.floor(Math.random()*100);
            db.users.push({ user: userKey, pass: "123", name: name, role: role, firstAccess: true });
            save();
            alert(`Sucesso! Usu√°rio: ${userKey} | Senha: 123`);
        }

        function exportToExcel() {
            const ws = XLSX.utils.json_to_sheet(db.records);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "ASSOPESCA");
            XLSX.writeFile(wb, "Relatorio_SigaPesca.xlsx");
        }

        function logout() { location.reload(); }
    </script>
</body>
</html>

