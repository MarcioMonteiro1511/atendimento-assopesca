<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Sistema Administrativo</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0}
header{background:#0d6efd;color:#fff;padding:15px;text-align:center}
.container{padding:20px}
.card{background:#fff;padding:20px;margin-bottom:20px;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,0.1)}
input,select,button{padding:8px;margin:5px 0;width:100%}
button{background:#0d6efd;color:white;border:none;border-radius:5px;cursor:pointer}
button:hover{background:#084298}
.hidden{display:none}
.logout{background:#dc3545}
.logout:hover{background:#a71d2a}
h2{margin-top:0}
</style>
</head>
<body>

<header>
<h2>SISTEMA ADMINISTRATIVO ASSOPESCA</h2>
</header>

<div class="container">

<!-- LOGIN -->
<div id="loginBox" class="card">
<h3>Login</h3>
<input type="text" id="loginUser" placeholder="Usuário">
<input type="password" id="loginPass" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>

<!-- TROCA SENHA -->
<div id="trocaSenhaBox" class="card hidden">
<h3>Trocar Senha</h3>
<input type="password" id="novaSenha" placeholder="Nova senha">
<button onclick="trocarSenha()">Salvar</button>
</div>

<!-- COLABORADOR -->
<div id="colaboradorArea" class="hidden">

<div class="card">
<h3>Registrar Atendimento</h3>
<input type="text" id="socio" placeholder="Nome do Sócio">
<input type="text" id="inscricao" placeholder="Inscrição">

<select id="servicoSelect"></select>

<button onclick="registrarAtendimento()">Registrar</button>
</div>

<button class="logout" onclick="logout()">Sair</button>

</div>

<!-- ADMIN -->
<div id="adminArea" class="hidden">

<div class="card">
<h3>Dashboard Geral</h3>
<canvas id="graficoGeral"></canvas>
</div>

<div class="card">
<h3>Dashboard Individual</h3>
<select id="filtroColaborador" onchange="gerarGraficoIndividual()"></select>
<canvas id="graficoIndividual"></canvas>
</div>

<div class="card">
<h3>Cadastrar Colaborador</h3>
<input type="text" id="novoUser" placeholder="Nome usuário">
<select id="novoTipo">
<option value="colaborador">Colaborador</option>
<option value="admin">Administrador</option>
</select>
<button onclick="cadastrarUsuario()">Cadastrar</button>
</div>

<button class="logout" onclick="logout()">Sair</button>

</div>

</div>

<script>

// ===== SERVIÇOS FIXOS =====
let servicos = [
"Manutenção RGP",
"Edição dados RGP",
"Solicitação RGP novo",
"Recadastramento",
"Recurso RGP suspenso",
"Emissão declarações",
"Agendamentos aposentadoria",
"Agendamentos salário materno",
"Agendamentos auxílio doença",
"Protocolo seguro defeso",
"Consulta seguro defeso",
"Recursos seguro defeso",
"Atualização cadastro INSS",
"Atualização cadastro Receita Federal",
"Emissão NIT",
"Emissão matrícula CEI",
"Emissão carteira RGP",
"Emissão carteira de sócio"
];

// ===== USUÁRIOS INICIAIS =====
if(!localStorage.getItem("usuarios")){
let usuariosPadrao=[
{user:"Elizângela",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Raquel",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Fernando",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Sarah",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Mayla",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Halana",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Wanda",tipo:"colaborador",senha:hash("00"),primeiro:true},
{user:"Márcio",tipo:"admin",senha:hash("2006"),primeiro:true},
{user:"Arthur",tipo:"admin",senha:hash("2006"),primeiro:true},
{user:"Antônio",tipo:"admin",senha:hash("2006"),primeiro:true}
];
localStorage.setItem("usuarios",JSON.stringify(usuariosPadrao));
}

if(!localStorage.getItem("atendimentos")){
localStorage.setItem("atendimentos",JSON.stringify([]));
}

let usuarioLogado=null;

// ===== HASH SHA256 =====
function hash(text){
return CryptoJS.SHA256(text).toString();
}

// carregar CryptoJS
var script=document.createElement('script');
script.src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js";
document.head.appendChild(script);

// ===== LOGIN =====
function login(){
let user=document.getElementById("loginUser").value;
let pass=document.getElementById("loginPass").value;
let usuarios=JSON.parse(localStorage.getItem("usuarios"));

let encontrado=usuarios.find(u=>u.user===user && u.senha===hash(pass));

if(!encontrado){alert("Login inválido");return;}

usuarioLogado=encontrado;

if(encontrado.primeiro){
document.getElementById("loginBox").classList.add("hidden");
document.getElementById("trocaSenhaBox").classList.remove("hidden");
}else{
entrarSistema();
}
}

// ===== TROCAR SENHA =====
function trocarSenha(){
let nova=document.getElementById("novaSenha").value;
let usuarios=JSON.parse(localStorage.getItem("usuarios"));
let u=usuarios.find(u=>u.user===usuarioLogado.user);
u.senha=hash(nova);
u.primeiro=false;
localStorage.setItem("usuarios",JSON.stringify(usuarios));
alert("Senha atualizada");
entrarSistema();
}

// ===== ENTRAR =====
function entrarSistema(){
document.getElementById("trocaSenhaBox").classList.add("hidden");
if(usuarioLogado.tipo==="colaborador"){
carregarServicos();
document.getElementById("colaboradorArea").classList.remove("hidden");
}else{
carregarFiltroColaborador();
gerarGraficoGeral();
document.getElementById("adminArea").classList.remove("hidden");
}
}

// ===== CARREGAR SERVIÇOS =====
function carregarServicos(){
let select=document.getElementById("servicoSelect");
select.innerHTML="";
servicos.forEach(s=>{
let opt=document.createElement("option");
opt.value=s;
opt.textContent=s;
select.appendChild(opt);
});
}

// ===== REGISTRAR ATENDIMENTO =====
function registrarAtendimento(){
let socio=document.getElementById("socio").value;
let inscricao=document.getElementById("inscricao").value;
let servico=document.getElementById("servicoSelect").value;

let atendimentos=JSON.parse(localStorage.getItem("atendimentos"));

atendimentos.push({
colaborador:usuarioLogado.user,
socio,
inscricao,
servico,
data:new Date().toLocaleString()
});

localStorage.setItem("atendimentos",JSON.stringify(atendimentos));
alert("Atendimento registrado");
document.getElementById("socio").value="";
document.getElementById("inscricao").value="";
}

// ===== DASHBOARD GERAL =====
function gerarGraficoGeral(){
let atendimentos=JSON.parse(localStorage.getItem("atendimentos"));
let contagem={};
atendimentos.forEach(a=>{
contagem[a.colaborador]=(contagem[a.colaborador]||0)+1;
});

new Chart(document.getElementById("graficoGeral"),{
type:'bar',
data:{labels:Object.keys(contagem),
datasets:[{label:'Atendimentos',data:Object.values(contagem)}]}
});
}

// ===== DASHBOARD INDIVIDUAL =====
function carregarFiltroColaborador(){
let select=document.getElementById("filtroColaborador");
let usuarios=JSON.parse(localStorage.getItem("usuarios"));
select.innerHTML="";
usuarios.filter(u=>u.tipo==="colaborador").forEach(u=>{
let opt=document.createElement("option");
opt.value=u.user;
opt.textContent=u.user;
select.appendChild(opt);
});
}

function gerarGraficoIndividual(){
let nome=document.getElementById("filtroColaborador").value;
let atendimentos=JSON.parse(localStorage.getItem("atendimentos"));
let contagem={};
atendimentos.filter(a=>a.colaborador===nome)
.forEach(a=>{
contagem[a.servico]=(contagem[a.servico]||0)+1;
});

new Chart(document.getElementById("graficoIndividual"),{
type:'pie',
data:{labels:Object.keys(contagem),
datasets:[{data:Object.values(contagem)}]}
});
}

// ===== CADASTRAR USUÁRIO =====
function cadastrarUsuario(){
let user=document.getElementById("novoUser").value;
let tipo=document.getElementById("novoTipo").value;
let usuarios=JSON.parse(localStorage.getItem("usuarios"));

if(usuarios.find(u=>u.user===user)){
alert("Usuário já existe");return;
}

usuarios.push({
user,
tipo,
senha:hash(tipo==="admin"?"2006":"00"),
primeiro:true
});

localStorage.setItem("usuarios",JSON.stringify(usuarios));
alert("Usuário cadastrado");
}

// ===== LOGOUT =====
function logout(){
location.reload();
}

</script>

</body>
</html>
